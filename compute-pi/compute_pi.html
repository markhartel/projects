<!doctype html>
<html lang="en">
<head>
  <title>Compute PI</title>
  <meta charset="utf-8">
  <style>
    p span {
        overflow-wrap: anywhere;
    }   
  </style>
  <script type="text/javascript" src="decimal.js"></script>
</head>
<body>
    <h1>Compute PI</h1>
    <form id="computeForm">
        <label for="precision">Precision:</label>
        <input id="precision" type="number" value="20" min="20" max="1012"></input>
        <label for="iterations">Number of iterations:</label>
        <input id="iterations" type="number" value="0" min="0"></input>
        <input type="submit" id="computeButton" value="Compute">
    </form>
    <p>X = <span id="x-number"></span></p>
    <p>PI = <span id="pi-number"></span></p>
    <p>Y = <span id="y-number"></span></p>
    <p>Miss Index = <span id="miss-index"></span></p>
    <script type="text/javascript">
        var PItest = '3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789';

        window.onload = function() {
            var form = document.getElementById("computeForm");
            form.onsubmit = computeHandler
        };

        function computeHandler(evt) {
            evt.preventDefault();
            precision = parseInt(document.getElementById("precision").value);
            iteration = parseInt(document.getElementById("iterations").value);
            var D = Decimal.clone({ precision: precision });
            var x = new D('2').sqrt();
            var pi = new D('2').plus(x);
            var y = new D('2').pow('0.25');
            for (i=0; i < iteration; i++) {
                var sqrtx = x.sqrt();
                var invsqrtx = new D('1').dividedBy(sqrtx);
                x = sqrtx.plus(invsqrtx).dividedBy('2');
                var xplus1 = x.plus('1');
                var yplus1 = y.plus('1');
                pi = xplus1.dividedBy(yplus1).times(pi);
                sqrtx = x.sqrt();
                invsqrtx = new D('1').dividedBy(sqrtx);
                y = y.times(sqrtx).plus(invsqrtx).dividedBy(yplus1);
            }
            var missIndex = -1;
            var piStr = pi.toFixed();
            for (i=0; i < piStr.length; i++) {
                if (piStr.charAt(i) !== PItest.charAt(i)) {
                    missIndex = i;
                    break;
                }
            }
            document.getElementById("x-number").innerHTML = x.toFixed();
            document.getElementById("pi-number").innerHTML = pi.toFixed();
            document.getElementById("y-number").innerHTML = y.toFixed();
            document.getElementById("miss-index").innerHTML = missIndex;
       }
    </script>
</body>
</html>
