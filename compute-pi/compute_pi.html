<!doctype html>
<html lang="en">
<head>
  <title>Compute PI</title>
  <meta charset="utf-8">
  <style>
    p span {
        overflow-wrap: anywhere;
    }   
  </style>
  <script type="text/javascript" src="decimal.js"></script>
</head>
<body>
    <h1>Compute PI</h1>
    <p>Uses <a href="https://en.wikipedia.org/wiki/Borwein%27s_algorithm">Borwein's quadratic convergence algorithm</a> and the <a href="https://github.com/MikeMcl/decimal.js">decimal.js</a> arbitrary-precision numerical package to iteratively compute the value of Pi.</p>
    <form id="computeForm">
        <table>
        <tr>
            <td><label for="precision">Precision:</label></td>
            <td><input id="precision" type="number" value="20" min="20"></input></td>
        </tr>
        <tr>
            <td><label for="iterations">Iterations:</label></td>
            <td><input id="iterations" type="number" value="0" min="0"></input></td>
        </tr>
        <tr>
            <td><input type="submit" id="computeButton" value="Compute"></td><td></td>
        </tr>
        </table>
    </form>
    <p>A<sub></sub> = <span id="x-number"></span></p>
    <p>B<sub></sub> = <span id="y-number"></span></p>
    <p>PI<sub></sub> = <span id="pi-number"></span></p>
    <p>Miss Index = <span id="miss-index"></span></p>
    <script type="text/javascript">
        var PItest = '3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789';

        window.onload = function() {
            var form = document.getElementById("computeForm");
            form.onsubmit = computeHandler
        };

        function computeHandler(evt) {
            evt.preventDefault();
            precision = parseInt(document.getElementById("precision").value);
            iteration = parseInt(document.getElementById("iterations").value);
            var D = Decimal.clone({ precision: precision });
            var x = new D('2').sqrt();
            var pi = new D('2').plus(x);
            var y = new D('0'); //new D('2').pow('0.25');
            for (i=0; i < iteration; i++) {
                var x0 = new D(x);
                var sqrtx = x0.sqrt();
                var invsqrtx = new D('1').dividedBy(sqrtx);
                x = sqrtx.plus(invsqrtx).dividedBy('2');
                var y0 = new D(y);
                var xplusy = x0.plus(y0);
                y = new D(1).plus(y0).times(sqrtx).dividedBy(xplusy);
                var pi0 = new D(pi);
                var oneplusy = new D(1).plus(y);
                pi = new D(1).plus(x).times(pi0).times(y).dividedBy(oneplusy);
                /*
                var sqrtx = x.sqrt();
                var invsqrtx = new D('1').dividedBy(sqrtx);
                x = sqrtx.plus(invsqrtx).dividedBy('2');
                var xplus1 = x.plus('1');
                var yplus1 = y.plus('1');
                pi = xplus1.dividedBy(yplus1).times(pi);
                sqrtx = x.sqrt();
                invsqrtx = new D('1').dividedBy(sqrtx);
                y = y.times(sqrtx).plus(invsqrtx).dividedBy(yplus1);
                */
            }
            var missIndex = -1;
            var piStr = pi.toFixed();
            var buff = '';
            var miss = false;
            for (i=0; i < piStr.length; i++) {
                if (!miss) {
                    if (i >= PItest.length) {
                        miss = true;
                        buff += '<span style="color:red">';
                    }
                    else if (piStr.charAt(i) !== PItest.charAt(i)) {
                        miss = true;
                        missIndex = i;
                        buff += '<span style="color:red">';
                    }
                }
                buff += piStr.charAt(i);
            }
            if (miss) {
                buff += '</span>';
            }
            var subscripts = document.getElementsByTagName("sub");
            for (i = 0; i < subscripts.length; i++) {
                subscripts[i].innerHTML = iteration;
            }
            document.getElementById("x-number").innerHTML = x.toFixed();
            document.getElementById("pi-number").innerHTML = buff;
            document.getElementById("y-number").innerHTML = y.toFixed();
            document.getElementById("miss-index").innerHTML = missIndex;
       }
    </script>
</body>
</html>
